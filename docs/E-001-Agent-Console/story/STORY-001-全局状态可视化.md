# STORY-001：全局状态可视化

> **文档路径**：`/docs/E-001-Agent-Console/story/STORY-001-全局状态可视化.md`
>
> * **STORY ID**：STORY-001
> * **EPIC_ID**：E-001
> * **EPIC_DIR**：`E-001-Agent-Console`
> * **关联 PRD**：`../prd/PRD-E-001-v0.md#场景1-启动工作区`
> * **状态**：待开发
> * **优先级**：P0（最高）
> * **创建日期**：2026-01-20
> * **预计完成**：[OPEN]

---

## 1. User Story 文本

**作为一个** 开发者（用户自己）

**我想要** 打开应用后，一眼就能看到所有 dev 的状态和任务依赖关系

**以便于** 我能在 30 秒内从"焦虑"到"掌控"，不再需要在多个终端间切换

---

## 2. 背景与动机

### 2.1 痛点（来自 PRD 场景 1）

**P1：认知过载**
- 需要在多个终端窗口间切换，每个终端对应一个 Claude Code 实例
- 需要记住哪个 dev 在做什么任务，当前进度如何
- 4 个并行 dev 已经达到认知极限

**P2：知识断层**
- 文档（Epic/PRD/TECH/STORY/TASK）之间的关系是隐式的
- 无法快速回答"这个 Task 是为了解决什么业务问题"

### 2.2 当前成本

- **时间成本**：10-15 分钟才能理清 4 个 dev 的状态
- **认知负荷**：需要记住 4 个并行上下文
- **错误率**：约 40% 的概率会遗漏某个 dev 的进度

### 2.3 预期价值

- ✅ 状态理解时间：从 10-15 分钟 → < 2 分钟
- ✅ 需要记忆的信息：从"记 4 个 dev 的状态" → 0（屏幕可见）
- ✅ 终端切换次数：从 4-8 次 → 0 次
- ✅ 问题发现率：从约 60% → 100%

---

## 3. 主要使用场景（主路径步骤）

### 3.1 场景：从"焦虑"到"掌控"

**触发条件**：早上 9:00，开始工作前，昨天让 4 个 dev 并行干活，过了一晚

**主路径**：

1. **用户双击应用图标**
   - 应用在 3 秒内启动，显示完整界面
   - **成功标志**：看到主界面布局（知识图谱 + 员工档案）

2. **用户扫一眼知识图谱树**
   - 看到所有 Epic/PRD/STORY/TASK 的依赖关系和状态
   - **成功标志**：能识别出 TASK-03（黄色高亮）还在 TODO

3. **用户扫一眼员工档案**
   - 看到 4 个 dev 的状态（空闲/忙碌/错误）
   - **成功标志**：能看到 Dave-1（绿色空闲）、Terry（红色错误）

4. **用户识别可分派的任务**
   - TODO 状态的 TASK 高亮显示
   - **成功标志**：知道 TASK-03 没人做，可以分派

5. **用户识别需要处理的异常**
   - 错误状态的 dev 用红色高亮
   - **成功标志**：发现 Terry 崩溃了（红色高亮，一眼就能看到）

6. **用户做出决策**
   - 知道该干什么了（重启 Terry + 给 Dave-1 分派 TASK-03）
   - **情绪变化**：从"焦虑/不确定" → "掌控/清晰"

**完成标志**：用户能在 30 秒内理解所有 dev 的状态，并知道下一步该做什么

---

## 4. 状态机（关键状态与跃迁）

### 4.1 知识图谱树的状态机

```
┌──────────┐  启动应用  ┌──────────┐  加载文档  ┌──────────┐
│  初始态   │ ────────> │  加载态   │ ────────> │  成功态   │
│ (空页面)  │           │(骨架屏)  │           │(显示图谱) │
└──────────┘           └──────────┘           └──────────┘
                                                  │
                                                  │ 文档变化
                                                  ▼
                                          ┌──────────┐
                                          │  刷新态   │
                                          │(防抖2秒) │
                                          └──────────┘
```

**关键跃迁**：
- **初始态 → 加载态**：应用启动，开始监听 `docs/` 目录
- **加载态 → 成功态**：解析完所有文档 Frontmatter，构建完成 DAG
- **成功态 → 刷新态**：文件系统变化（新增/修改/删除文档），触发防抖
- **刷新态 → 成功态**：防抖结束（2 秒后无新变化），重新解析文档

**恢复路径**：
- 如果解析失败 → 进入失败态（显示错误图标 + 重试按钮）
- 如果用户点击"重试" → 重新进入加载态

### 4.2 员工档案的状态机

```
┌──────────┐  启动应用  ┌──────────┐  加载配置  ┌──────────┐
│  初始态   │ ────────> │  加载态   │ ────────> │  成功态   │
│ (空页面)  │           │(骨架屏)  │           │(显示列表) │
└──────────┘           └──────────┘           └──────────┘
                                                  │
                                                  │ Agent 状态变化
                                                  ▼
                                          ┌──────────┐
                                          │  更新态   │
                                          │(实时刷新) │
                                          └──────────┘
```

**关键跃迁**：
- **初始态 → 加载态**：应用启动，开始读取 Agent 配置文件
- **加载态 → 成功态**：加载完所有 Agent 配置（从 `agents.yaml` 或默认配置）
- **成功态 → 更新态**：Agent 状态变化（如从 IDLE → BUSY）
- **更新态 → 成功态**：更新员工档案卡片（延迟 < 1 秒）

**恢复路径**：
- 如果配置文件不存在 → 显示"暂无员工"提示（空态）
- 如果配置文件损坏 → 显示"无法加载 Agent 配置"错误（失败态）

### 4.3 节点状态的颜色映射

| 状态 | 颜色 | 边框 | 图标 | 说明 |
|------|------|------|------|------|
| **TODO** | 白色背景 | 灰色虚线边框 | ⚪ | 待开始的任务 |
| **DOING** | 白色背景 | 蓝色实线边框 | 🔵 | 正在执行的任务 |
| **BLOCKED** | 白色背景 | 红色虚线边框 | 🛑 | 被阻塞的任务 |
| **DONE** | 浅绿色背景 | 绿色实线边框 | ✅ | 已完成的任务 |

---

## 5. 验收标准（Acceptance Criteria）

### AC1：应用启动时间 < 3 秒

**步骤**：
1. 用户双击 Commander Console 应用图标
2. 计时开始（应用进程启动）
3. 等待主界面完全显示（知识图谱树 + 员工档案）
4. 计时结束

**期望结果**：
- ✅ 启动时间 < 3 秒（从双击到界面完全显示）
- ✅ 没有明显的卡顿或闪烁
- ✅ 主界面布局完整（知识图谱 40% + 员工档案 30% + 其他区域 30%）

**测试方式**：手工计时 + 性能分析工具（如 Chrome DevTools Performance）

---

### AC2：知识图谱树正确显示文档依赖关系

**步骤**：
1. 用户打开应用
2. 观察知识图谱树的节点和边
3. 点击一个 TASK 节点（如 TASK-03）
4. 观察高亮显示的依赖路径

**期望结果**：
- ✅ 节点类型正确：EPIC（黄色）、PRD（蓝色）、TECH（紫色）、STORY（绿色）、TASK（灰色）
- ✅ 节点状态正确：TODO/DOING/BLOCKED/DONE 用颜色标识
- ✅ 依赖路径清晰：EPIC → PRD → STORY → TASK 的层级关系正确
- ✅ 点击 TASK 后，依赖路径用黄色高亮显示
- ✅ 依赖路径可读性：路径线不会交叉混乱

**测试数据**：使用 `docs/E-001-xxx/` 下的真实文档

---

### AC3：员工档案正确显示 Agent 状态

**步骤**：
1. 用户打开应用
2. 观察员工档案的 Agent 卡片
3. 检查每个 Agent 的状态、技能标签、当前任务

**期望结果**：
- ✅ Agent 列表完整：至少包含 Tiger、Dave-1、Dave-2、Terry（默认配置）
- ✅ Agent 状态正确：IDLE（绿色）、BUSY（蓝色）、ERROR（红色）、RELEASED（灰色）
- ✅ 技能标签正确：Tiger（架构）、Dave-1/2（后端）、Terry（测试）
- ✅ 当前任务显示：如果 Agent 正在执行任务，显示 TASK ID 和任务名称
- ✅ 卡片交互：点击 Agent 卡片，能看到详细信息（弹窗或侧边栏）

**测试方式**：手工检查每个 Agent 卡片的信息完整性

---

### AC4：文档变化后，知识图谱在 2 秒内自动刷新

**步骤**：
1. 用户打开应用，观察当前的知识图谱树
2. 用户修改一个文档的 Frontmatter（如将 TASK-03 的状态从 TODO 改为 DOING）
3. 保存文档
4. 等待知识图谱树刷新

**期望结果**：
- ✅ 知识图谱树在 2 秒内自动刷新（防抖 2 秒）
- ✅ 节点状态更新：TASK-03 的边框从灰色虚线 → 蓝色实线
- ✅ 没有页面闪烁或卡顿
- ✅ 刷新过程中显示加载动画（可选）

**测试方式**：手工修改文档 + 计时

---

### AC5：用户能在 30 秒内理解所有 dev 的状态

**步骤**：
1. 用户打开应用（模拟早上 9:00 开始工作前）
2. 计时开始
3. 用户扫一眼知识图谱树 + 员工档案
4. 用户回答以下问题：
   - 哪些 Agent 空闲？
   - 哪些 Agent 忙碌？
   - 哪些 Agent 出错了？
   - 哪些任务 TODO？
   - 哪些任务 DOING？
5. 计时结束

**期望结果**：
- ✅ 理解时间 < 30 秒
- ✅ 用户能准确回答所有问题（错误率 < 10%）
- ✅ 用户不需要切换到终端或打开文档

**测试方式**：用户测试 + 问卷调查

---

## 6. 边界与异常

### 6.1 空态（没有文档或 Agent）

| 组件 | 空态表现 | 引导操作 |
|------|---------|---------|
| **知识图谱树** | 显示"暂无项目数据"提示 | 引导用户创建第一个 Epic（链接到 biz-overview） |
| **员工档案** | 显示"暂无员工"提示 | 引导用户配置 Agent（链接到配置文档） |

**验收标准**：
- ✅ 空态提示文案清晰，用户知道下一步该做什么
- ✅ 空态不影响应用的稳定性（不崩溃）

---

### 6.2 失败态（文档解析失败）

| 失败场景 | 错误提示 | 恢复路径 |
|---------|---------|---------|
| **Frontmatter 格式错误** | 显示错误图标 + "文档解析失败：PRD-E-001-v0.md" | 提供"重试"按钮（重新解析） |
| **文档不存在** | 显示警告图标 + "文档已删除：TASK-03" | 提供"从 git 历史恢复"按钮 |
| **依赖关系循环** | 显示错误图标 + "检测到循环依赖：TASK-01 → TASK-02 → TASK-01" | 提供"查看循环路径"按钮 + "手动修复"提示 |

**验收标准**：
- ✅ 错误信息友好（不显示技术栈错误）
- ✅ 提供清晰的恢复路径
- ✅ 单个文档解析失败不影响其他文档的显示

---

### 6.3 性能边界（大规模数据）

| 场景 | 触发条件 | 降级方案 |
|------|---------|---------|
| **节点超过 100 个** | 知识图谱树节点过多，渲染卡顿 | 提供"折叠/过滤"功能：默认展开 3 层，深层节点折叠 |
| **文档超过 1000 个** | 文件监听性能下降 | 提供"监听范围限制"：只监听 `docs/_project/` 和当前 Epic 目录 |
| **Agent 超过 20 个** | 员工档案卡片过多，滚动困难 | 提供"搜索/筛选"功能：按状态、技能筛选 |

**验收标准**：
- ✅ 降级方案不影响核心功能（用户仍然能看到所有信息）
- ✅ 性能监控：加载时间、渲染帧率（FPS）保持在可接受范围

---

### 6.4 重复操作（用户快速修改文档）

**场景**：用户在 1 秒内连续修改 3 个文档

**问题**：如果每次修改都触发刷新，会导致性能问题

**解决方案**：
- 使用防抖（debounce）机制：2 秒内的多次修改只触发一次刷新
- 显示"检测到文件变化，2 秒后刷新"提示

**验收标准**：
- ✅ 防抖时间 < 2 秒（用户体验不会觉得卡顿）
- ✅ 防抖期间显示提示，用户知道系统在响应

---

### 6.5 超时（文档解析超时）

**场景**：某个文档非常大（> 1MB），解析时间超过 5 秒

**错误提示**：显示"文档解析超时：PRD-E-001-v0.md（文件过大）"

**恢复路径**：
- 提供"跳过此文档"按钮（继续显示其他文档）
- 提供"重试解析"按钮
- 提供"优化文档"提示（建议用户拆分文档）

**验收标准**：
- ✅ 超时时间 < 5 秒（避免用户等待太久）
- ✅ 单个文档超时不影响其他文档的显示

---

### 6.6 权限（Phase 1 只有主用户）

**当前规则**：Phase 1 只有主用户（开发者自己）使用，无需权限控制

**未来扩展**（Phase 2）：
- 只读用户：只能查看知识图谱和员工档案，不能修改
- 编辑用户：可以修改文档，但不能删除
- 管理员：完全控制

**验收标准**（Phase 1）：
- ✅ 不需要登录或权限验证
- ✅ 所有功能对所有用户开放

---

## 7. 接口契约草案（Interface Contract Draft）

> **说明**：本章节用自然语言描述接口的业务字段含义和边界条件，不涉及具体类型签名。
> **技术实现**：由 tech agent 在 TECH 文档中定义最终的 TypeScript/Rust 类型定义。

### 7.1 Rust → 前端：文档列表推送

**触发时机**：
- 应用启动时（推送所有文档）
- 文件系统变化时（推送新增/修改的文档）

**请求结构**（Rust → 前端，通过 Tauri Event）：
```yaml
event_name: "docs:updated"

payload:
  documents:
    - id: "E-001"                              # 文档唯一标识
      type: "EPIC"                             # 文档类型：EPIC / PRD / TECH / STORY / TASK
      name: "移动端 App"                        # 文档名称（从 Frontmatter title 字段）
      status: "DOING"                          # 文档状态：TODO / DOING / BLOCKED / DONE
      path: "/docs/E-001-xxx/biz/BIZ-E-001-v0.md"  # 文档绝对路径
      parent_id: null                          # 父节点 ID（EPIC 无父节点）
      dependencies:                            # 依赖的文档 ID 列表
        - "PRD-E-001-v1"
        - "TECH-E-001-v1"
      metadata:                                # 其他元数据（从 Frontmatter 提取）
        epic_id: "E-001"
        version: "v0"
        created_at: "2026-01-14"
        updated_at: "2026-01-20"

  timestamp: "2026-01-20T10:00:00Z"            # 推送时间（ISO 8601 格式）
```

**边界条件**：
- **文档列表为空**：返回空数组 `[]`，前端显示空态
- **文档路径不存在**：不包含在列表中，前端不显示
- **Frontmatter 缺失**：使用默认值（name="未知文档", status="TODO"）

**性能要求**：
- 单次推送文档数量 < 1000 个（Phase 1 不会超过）
- 推送延迟 < 1 秒（从文件变化到前端收到事件）

---

### 7.2 前端 → Rust：打开文档

**触发时机**：用户点击知识图谱树中的节点

**请求结构**（前端 → Rust，通过 Tauri Command）：
```yaml
command_name: "open_document"

request:
  document_path: "/docs/E-001-xxx/prd/PRD-E-001-v1.md"  # 文档绝对路径
  line_number: 123                                      # 可选：跳转到指定行（高亮相关章节）

response:
  success: true
  error_message: null                                   # 失败时显示错误信息
```

**边界条件**：
- **文档不存在**：返回 `success: false, error_message: "文档不存在"`
- **文档格式不支持**：返回 `success: false, error_message: "不支持的文件格式"`
- **line_number 超出范围**：忽略，跳转到文档开头

**性能要求**：
- 文档打开时间 < 1 秒（从点击到显示文档内容）
- 大文档（> 1MB）允许显示"加载中"动画，最多等待 3 秒

---

### 7.3 Rust → 前端：Agent 状态推送

**触发时机**：
- 应用启动时（推送所有 Agent 状态）
- Agent 状态变化时（实时推送）

**请求结构**（Rust → 前端，通过 Tauri Event）：
```yaml
event_name: "agents:status_updated"

payload:
  agents:
    - id: "dave-1"                           # Agent 唯一标识
      name: "Dave-1"                         # Agent 显示名称
      status: "IDLE"                         # Agent 状态：IDLE / BUSY / ERROR / RELEASED
      current_task:                          # 当前执行的任务（如果 status=BUSY）
        task_id: "TASK-03"
        task_name: "用户登录 API 实现"
        started_at: "2026-01-20T10:00:00Z"
      skills:                                # 技能标签
        - "后端"
        - "Rust"
      last_active: "2026-01-20T10:05:00Z"    # 最后活动时间（用于判断闲置）
      process_id: 12345                      # 进程 ID（如果 status=BUSY）

  timestamp: "2026-01-20T10:05:00Z"
```

**边界条件**：
- **Agent 列表为空**：返回空数组 `[]`，前端显示空态
- **Agent 未启动**：status = "RELEASED"，process_id = null
- **current_task 为空**：status != "BUSY" 时，current_task = null

**性能要求**：
- 推送延迟 < 1 秒（从状态变化到前端收到事件）
- 最多支持 20 个 Agent（Phase 1 不会超过 4 个）

---

### 7.4 前端 → Rust：获取 Agent 详细信息

**触发时机**：用户点击员工档案中的 Agent 卡片

**请求结构**（前端 → Rust，通过 Tauri Command）：
```yaml
command_name: "get_agent_details"

request:
  agent_id: "dave-1"

response:
  success: true
  agent:
    id: "dave-1"
    name: "Dave-1"
    status: "IDLE"
    current_task: null
    skills: ["后端", "Rust"]
    history:                                  # 历史任务记录（最近 5 个）
      - task_id: "TASK-02"
        task_name: "数据库设计"
        status: "DONE"
        completed_at: "2026-01-19T15:30:00Z"
        duration_seconds: 3600
      - task_id: "TASK-01"
        task_name: "项目初始化"
        status: "DONE"
        completed_at: "2026-01-18T10:00:00Z"
        duration_seconds: 1800
    last_active: "2026-01-20T10:05:00Z"
    process_id: null
  error_message: null
```

**边界条件**：
- **Agent 不存在**：返回 `success: false, error_message: "Agent 不存在"`
- **history 为空**：返回空数组 `[]`（新 Agent 没有历史任务）
- **Agent 正在执行任务**：current_task 不为空，history 包含历史任务

**性能要求**：
- 响应时间 < 500ms（从点击到显示详细信息）

---

### 7.5 前端 → Rust：高亮依赖路径

**触发时机**：用户点击知识图谱树中的 TASK 节点

**请求结构**（前端 → Rust，通过 Tauri Command）：
```yaml
command_name: "highlight_dependency_path"

request:
  document_id: "TASK-03"                      # 选中的文档 ID

response:
  success: true
  path:                                      # 依赖路径（从根节点到选中节点）
    - document_id: "E-001"
      type: "EPIC"
      name: "移动端 App"
    - document_id: "PRD-E-001-v1"
      type: "PRD"
      name: "需求规格 v1"
    - document_id: "STORY-101"
      type: "STORY"
      name: "用户登录闭环"
    - document_id: "TASK-03"
      type: "TASK"
      name: "后端 API 实现"
  error_message: null
```

**边界条件**：
- **文档不存在**：返回 `success: false, error_message: "文档不存在"`
- **文档没有依赖路径**：返回 `path: []`（如 EPIC 根节点）
- **依赖路径过长**（> 10 个节点）：返回前 10 个节点 + "..."（显示"路径过长"提示）

**性能要求**：
- 响应时间 < 500ms（从点击到高亮显示）

---

## 8. UI 证据引用

### 8.1 原型链接

**可运行 HTML 原型**：`/docs/E-001-Agent-Console/prototypes/index.html`

> 注：原型由 UX agent 生成，本 STORY 引用原型中的关键页面。

### 8.2 关键页面截图（从原型中引用）

#### 主界面布局

```
┌─────────────────────────────────────────────────────────┐
│  🕸️  指挥官全景图 (知识图谱)                            │
│  [ EPIC-001: 移动端 App ]                               │
│    │                                                    │
│    ├── 📘 [ PRD-v1: 需求规格 ]                         │
│    │       └─ 📄 [ STORY-101: 用户登录 ]              │
│    │                                                    │
│    ├── 📙 [ TECH-v1: 技术方案 ]                        │
│    │       └─ 🏗️ [ API-Schema: Auth接口定义 ]         │
│    │                                                    │
│    └── 📗 [ STORY-101: 用户登录闭环 ]                  │
│            │                                            │
│            ├── ✅ [ TASK-01: 后端 API 实现 ] (Dave-1)  │
│            └── 🟡 [ TASK-02: iOS 页面 ] (Dave-2)       │
├───────────────────────────┬─────────────────────────────┤
│  💬 讨论室 (规划大脑)      │  💻 运行终端 (执行肌肉)     │
│  [ 页签: Tiger | Dave-1 ]  │  [ 🟢 活跃: 2 | ⚪ 空闲: 1 ]│
│                           │                             │
│  (当前对话: Tiger)         │  +------------------------+│
│                           │  | 🟢 Dave-1 (后端开发)   ││
│  我: PRD 和 Tech 都好了。  │  | 正在执行: TASK-01      ││
│  让我们拆分 STORY-101。    │  | > cargo test --lib     ││
│                           │  +------------------------+│
│  Tiger: 好的。             │                             │
│  STORY-101 将拆分为:       │  +------------------------+│
│  1. TASK-01: 后端 API      │  | 🟡 Dave-2 (iOS 开发)   ││
│  2. TASK-02: iOS 页面      │  | 正在执行: TASK-02      ││
│                           │  +------------------------+│
└───────────────────────────┴─────────────────────────────┘
```

#### 知识图谱节点

```
┌─────────────────────┐
│  📘 PRD-v1          │
│  状态: ✅ DONE      │
│  关联: [Tiger]      │
└─────────────────────┘
         │
         ▼
┌─────────────────────┐
│  📄 STORY-101       │
│  状态: 🟡 DOING     │
│  关联: [Dave-1]     │
└─────────────────────┘
```

#### 员工档案卡片

```
┌─────────────────────────────────────────────────────────┐
│  🟢 Dave-1 (后端开发)                                    │
│  状态: 空闲                                              │
│  技能: 后端、Rust                                         │
│  当前任务: 无                                            │
│  历史任务: [TASK-02] ✅ [TASK-01] ✅                     │
└─────────────────────────────────────────────────────────┘
```

### 8.3 关键状态说明

#### 空态

- **知识图谱**：显示"暂无项目数据"提示，引导用户创建第一个 Epic
- **员工档案**：显示"暂无员工"提示，引导用户配置 Agent

#### 加载态

- **知识图谱**：显示骨架屏或加载动画（闪烁的占位符）
- **员工档案**：显示骨架屏（卡片形状的占位符）

#### 失败态

- **知识图谱**：文档解析失败时，显示错误图标和错误信息，提供"重试"按钮
- **员工档案**：Agent 信息获取失败时，显示"无法获取 Agent 状态"错误

#### 成功态

- **知识图谱**：显示完整的依赖关系树，节点状态用颜色标识
- **员工档案**：显示所有 Agent 的信息，状态实时更新

---

## 9. 依赖与备注

### 9.1 技术依赖

**前端技术栈**（来自 tech-baseline.md）：
- React 18+ + TypeScript 5+
- Zustand（状态管理）
- Cytoscape.js（知识图谱可视化）
- TailwindCSS + Shadcn/UI（UI 组件库）

**Rust 技术栈**（来自 tech-baseline.md）：
- Tauri v2（桌面框架）
- notify（文件监听）
- serde + serde_yaml（解析 Frontmatter）

**外部依赖**：
- 文档格式：Markdown + Frontmatter（YAML 格式）
- Agent 配置文件：`agents.yaml`（可选，Phase 1 可用默认配置）

---

### 9.2 STORY 依赖

**前置 STORY**：无（本 STORY 是第一个 STORY，优先级最高）

**后续 STORY**：
- **STORY-002（任务调度闭环）**：依赖本 STORY 的知识图谱树和员工档案
- **STORY-003（实时进度监控）**：依赖本 STORY 的 Agent 状态管理
- **STORY-004（自动资源管理）**：依赖本 STORY 的 Agent 状态监听

---

### 9.3 数据依赖

**文档 Frontmatter 格式**（必须包含的字段）：
```yaml
---
id: "PRD-E-001-v1"
type: "PRD"
title: "需求规格 v1"
status: "DONE"
epic_id: "E-001"
version: "v1"
created_at: "2026-01-14"
updated_at: "2026-01-20"
---
```

**Agent 配置文件格式**（`agents.yaml`）：
```yaml
agents:
  - id: "dave-1"
    name: "Dave-1"
    skills: ["后端", "Rust"]
    type: "backend"
  - id: "dave-2"
    name: "Dave-2"
    skills: ["iOS", "Swift"]
    type: "mobile"
```

---

### 9.4 风险与未决项

**[OPEN-1] 知识图谱布局算法选择**
- **问题**：Cytoscape.js 提供多种布局算法（breadthfirst、dagre、circle），选择哪个？
- **建议**：先测试 `breadthfirst`（树形布局），如果效果不好，再试 `dagre`（层次布局）
- **责任方**：tech

**[OPEN-2] 文档监听性能优化**
- **问题**：如果文档数量超过 1000 个，文件监听可能会有性能问题
- **建议**：Phase 1 先监听所有文档，如果性能有问题，再限制监听范围（只监听 `docs/_project/` 和当前 Epic 目录）
- **责任方**：tech

**[OPEN-3] Agent 配置文件位置**
- **问题**：`agents.yaml` 放在哪里？`~/.commander/agents.yaml` 还是项目根目录？
- **建议**：先支持项目根目录 `.commander/agents.yaml`，Phase 2 再支持全局配置
- **责任方**：prd + tech

**[OPEN-4] 知识图谱节点数量限制**
- **问题**：如果节点超过 100 个，如何处理？
- **建议**：提供"折叠/过滤"功能，默认展开 3 层，深层节点折叠
- **责任方**：prd + ux

---

### 9.5 非目标（Out of Scope）

本 STORY **不包含**：
- ❌ 讨论室（F2）：属于 STORY-002
- ❌ 运行终端（F3）：属于 STORY-003
- ❌ 进程管理（F4）：属于 STORY-004
- ❌ 手动调度（F6）：属于 STORY-002
- ❌ 自动任务调度（L2 级别）：属于 Phase 2
- ❌ 多用户支持：属于 Phase 2

---

## 10. 验收总结

### 10.1 核心验收点

| 验收点 | 验收方式 | 目标值 |
|-------|---------|-------|
| **应用启动时间** | 计时测试 | < 3 秒 |
| **知识图谱刷新时间** | 计时测试 | < 2 秒（防抖） |
| **状态理解时间** | 用户测试 | < 30 秒 |
| **文档打开时间** | 计时测试 | < 1 秒 |
| **节点状态正确性** | 手工检查 | 100% 正确 |
| **依赖路径清晰度** | 用户测试 | 10 秒内理解 |

### 10.2 质量门槛（来自 tech-baseline.md）

- ✅ 代码清晰：遵守 YAGNI 和 KISS 原则，单文件不超过 600 行
- ✅ 测试覆盖率：核心业务逻辑 50%（非 70%）
- ✅ 能跑、不崩、能验证核心价值

### 10.3 用户体验北极星验证

**体验北极星**：从"焦虑"到"掌控"，一眼看全局

**验证方式**：
- ✅ 用户能在 30 秒内理解所有 dev 的状态
- ✅ 用户不需要在终端间切换
- ✅ 用户能一眼看到哪个 dev 空闲、哪个任务 TODO
- ✅ 用户能发现异常（如 Terry 崩溃）

---

## 11. 变更记录

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v0.1 | 2026-01-20 | prd agent | 初版 STORY-001，基于 PRD 场景 1 |

---

## 附录：参考文档

- **PRD**：`/docs/E-001-Agent-Console/prd/PRD-E-001-v0.md`
- **Tech Baseline**：`/docs/_project/tech-baseline.md`
- **biz-overview**：`/docs/_project/biz-overview.md`
- **UI 原型**：`/docs/E-001-Agent-Console/prototypes/index.html`
