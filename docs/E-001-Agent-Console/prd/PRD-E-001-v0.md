# AI 员工管理控制台 - Commander Console PRD - v0（E-001）

> 文档路径：`/docs/E-001-Agent-Console/prd/PRD-E-001-v0.md`
>
> * EPIC_ID：E-001
> * EPIC_DIR：`E-001-Agent-Console`
> * 文档状态：草稿
> * 版本：v0
> * 创建人：yinwm
> * 创建日期：2026-01-14
> * 更新日期：2026-01-14

---

## 0. 关联信息（References）

* biz-overview：`/docs/_project/biz-overview.md`
* Story：`../story/STORY-*.md`（待生成）
* Tech Design：`../tech/TECH-E-001-v1.md`（待生成）
* Proj Plan：`../proj/PROJ-E-001-v1.md`（待生成）

---

## 1. 背景与动机（Background）

### 现状

用户正在开发 **VibedevTeam** 工作流框架，用于多 AI Dev 并行开发。目前已实现 Beads 任务管理系统、多 Agent 协作框架、标准化文档模板和 TDD 驱动开发流程。

在实际使用多 AI Dev 并行开发时，遇到以下核心问题：

1. **认知过载**：需要在多个终端间切换上下文，4 个并行 dev 已经"跟不住了"
2. **进度可视化缺失**：需要人工盯着终端看进度，任务状态散落在各处
3. **调度效率低**：手动识别可并行任务，手动在终端间切换
4. **知识断层**：Epic → PRD/TECH → STORY → TASK 的依赖关系不可见

### 问题

**P1：多 Agent 并行调度的认知负荷过高**
- 需要在多个终端窗口间切换，每个终端对应一个 Claude Code 实例
- 需要记住哪个 dev 在做什么任务，当前进度如何
- 手动判断任务依赖关系，决定分派顺序
- 4 个并行 dev 已经达到认知极限

**P2：知识依赖关系不可追溯**
- 文档（Epic/PRD/TECH/STORY/TASK）之间的关系是隐式的
- 讨论过程中的决策和背景知识散落在对话历史中
- 无法快速回答"这个 Task 是为了解决什么业务问题"

**P3：Agent 生命周期管理复杂**
- Claude Code 进程需要手动启动/杀死
- Session 恢复需要手动操作
- 资源管理（闲置 Agent 的释放）需要人工判断

### 影响

- 限制了并行度，无法充分利用 AI 的并行能力
- 容易出错，可能遗漏某个 dev 的进度
- 时间浪费在上下文切换上
- 新人（或未来的自己）难以理解全局
- 复盘和总结困难

---

## 2. 目标与成功标准（Goals & Success Metrics）

### 体验北极星（North Star）

> **"一眼看全局，一键触达任何 Agent，无需在终端间切换"**

### 体验原则

1. **最短路径原则**：从"想到"到"做到"不超过 2 次点击
2. **状态显式化**：所有 Agent 状态、任务状态必须实时可见
3. **优雅降级**：进程出错时，能清晰提示并提供恢复路径

### 本 Epic 业务目标（摘自 biz-overview）

| 目标ID | 目标（Goal） | 当前值 | 目标值 | 口径/备注 |
|------|------------|------|------|--------|
| G1 | 能同时管理的并行 Dev 数量 | 4 个 | 8+ 个 | 在不增加认知负荷的前提下 |
| G2 | 单次上下文切换时间 | [OPEN] | < 5 秒 | 从一个 Agent 的状态切换到另一个 Agent 的状态 |
| G3 | 任务依赖关系可见性 | 0% | 100% | 所有 TASK 都能追溯到对应的 PRD/TECH |
| G4 | Agent 闲置资源释放时间 | 人工 | 5 分钟 | 自动检测并释放闲置超过 5 分钟的 Agent |
| G5 | 全局状态刷新时间 | [OPEN] | < 1 秒 | 知识图谱树、Agent 状态等全局视图的刷新延迟 |

### 本 Epic 交付目标

- ✅ 交付可运行的 Tauri 桌面应用（macOS + Linux）
- ✅ 支持同时管理 4 个并行 dev 而不抓狂
- ✅ 一眼看到所有任务的状态和依赖关系
- ✅ 不需要在多个终端间切换
- ✅ 进程闲置 5 分钟后自动释放资源

---

## 3. 范围与非目标（Scope & Non-goals）

### 核心价值

让用户能舒适地管理 8+ 个并行 Dev，而不增加认知负荷。

### In Scope（MVP - Phase 1）

#### 1. 知识图谱树（F1）
- 解析文档 Frontmatter，显示 Epic → PRD/TECH → STORY → TASK 的依赖关系
- 实时更新（监听文件系统变化）
- 点击节点打开对应文档
- 显示任务状态（TODO/DOING/BLOCKED/DONE）
- 高亮显示当前关注的任务路径

#### 2. 讨论室（F2）
- 多 tab 支持，保持不同 Agent 的对话上下文
- 和具名 Agent（Tiger、Dave-1/2、Terry 等）进行多轮对话
- Agent 可以创建文档、编码（通过 Claude Code 的工具）
- 对话历史持久化（JSONL 格式）

#### 3. 运行终端（F3）
- 显示各个 Agent 的执行进度
- 实时日志流（stream-json 输出）
- 进程状态指示（运行中/空闲/错误）

#### 4. 进程管理（F4）
- 启动/杀死 Claude Code 进程
- Session 管理（从 JSONL 恢复上下文）
- 资源监控（内存、CPU、闲置时间）
- 自动释放闲置超过 5 分钟的 Agent

#### 5. 员工档案（F5）
- 显示每个"数字员工"的状态
- 当前任务、技能标签
- 历史任务记录（可选）

#### 6. 手动调度（F6）（L1 级别）
- 手动分派任务给 Agent
- 手动触发 Agent 启动/停止

### Out of Scope（Phase 2+）

#### 自动任务调度（L2 级别）
- 自动匹配"TASK-01 需要后端" → 找 Dave-1
- 自动检测任务依赖，识别可并行任务
- 依赖冲突检测和解决

#### 智能摘要
- 压缩对话历史，减少上下文长度
- 自动生成日报/周报

#### 自主协调（L3 级别）
- Agent 之间自主协商任务分配
- Agent 自主拆解任务

#### 非技术用户支持
- 傻瓜化操作界面
- 无需了解 Claude Code 即可使用

#### 多模态交互
- 语音输入/输出
- 可视化拖拽式任务编排

#### 团队协作
- 多用户共享控制台
- 权限管理
- 审计日志

---

## 4. 用户与场景（Users & Scenarios）

### 用户角色

**主用户**：开发者（用户自己）
- 技术能力强，熟悉 Claude Code
- 需要管理多个并行 AI Dev
- 需要可视化全局状态和任务依赖关系

**未来用户**（Phase 2+）：其他独立开发者/小团队
- 技术能力中等
- 需要降低使用门槛

### 关键场景

#### 场景 1：启动工作区 - 从"焦虑"到"掌控"

> 体验关键词：从"不知道4个dev在干什么"到"一眼看全状态"

---

##### 【用户旅程】

**早上 9:00** - 开始工作前 - 🟰 焦虑/不确定
- **情境**：昨天让4个dev（Tiger、Dave-1/2、Terry）并行干活，过了一晚
- **痛点**：**P1-认知过载** - 需要打开4个终端逐个看对话历史（引用 biz-overview P1）
- **内心独白**："昨天让他们干啥来着？现在进展咋样了？我得花10分钟捋一捋..."
- **当前成本**：10-15 分钟才能理清状态 + 高认知负荷（要记住4个并行上下文）

**9:01** - 打开 Commander Console - 😊 "还挺快"
- **动作**：双击应用图标
- **反馈**：3秒内应用启动，自动恢复昨天的工作区状态
- **感受**："哦，启动挺快，没让我等"
- **预期 vs 实际**：预期要等10秒（像其他桌面应用），实际只要3秒

**9:01:30** - 扫一眼屏幕 - 😌 "原来如此"
- **动作**：扫一眼知识图谱树 + 员工档案
- **反馈**：
  - 知识图谱树：TASK-03（黄色高亮）还在 TODO
  - 员工档案：Dave-1（绿色空闲）、Terry（红色错误）
- **感受**："哦，原来Dave-1闲着，Terry挂了，TASK-03还没人做"
- **预期 vs 实际**：预期要逐个点开终端看，实际扫一眼30秒就懂了

**9:02** - 做出决策 - 😄 "心里踏实了"
- **结果**：知道该干什么了（重启Terry + 给Dave-1分派TASK-03）
- **情绪变化**：从"焦虑/不确定" → "掌控/清晰"
- **价值感知**："这个控制台真有用，比之前快多了"

---

##### 【体验北极星验证】

- ✅ 从"焦虑"到"掌控"，只用了 2 分钟（之前需要 10-15 分钟）
- ✅ 不需要在终端间切换，一眼看全所有dev状态
- ✅ 认知负荷：从"记4个dev的状态" → "扫一眼屏幕"
- ✅ 发现问题：Terry 崩溃了（红色高亮，一眼就能看到）

| 指标 | Before（当前） | After（目标） | 验收方式 |
|------|---------------|--------------|---------|
| 状态理解时间 | 10-15 分钟 | < 2 分钟 | 计时测试 |
| 需要记忆的信息 | 4个dev的状态 | 0（屏幕可见） | 用户报告 |
| 终端切换次数 | 4-8 次 | 0 次 | 计数 |
| 问题发现率 | 约 60% | 100% | 故意注入崩溃测试 |

---

##### 【主路径】

1. **双击应用图标** → 应用在 3 秒内启动，显示完整界面
2. **扫一眼知识图谱树** → 看到所有 Epic/PRD/STORY/TASK 的依赖关系和状态
3. **扫一眼员工档案** → 看到4个dev的状态（空闲/忙碌/错误）
4. **识别可分派的任务** → TODO 状态的 TASK 高亮显示
5. **识别需要处理的异常** → 错误状态的 dev 用红色高亮

**成功标准**：
- ✅ 应用在 3 秒内启动完成
- ✅ 用户能在 30 秒内理解所有dev的状态
- ✅ 用户能一眼看到哪个dev空闲、哪个任务TODO

---

##### 【分叉点】

- **[分叉 1]** 如果有 Agent 崩溃（如 Terry 红色）
  - → 用户看到红色高亮 + 错误图标
  - → 提供"一键重启"按钮
  - → 点击后自动重启并恢复 Session

- **[分叉 2]** 如果所有 Agent 都忙碌
  - → 提供"启动新 Agent"按钮
  - → 显示"预计等待时间"（基于当前任务进度）

- **[分叉 3]** 如果有 Task 被阻塞
  - → 高亮显示阻塞路径（用虚线连接）
  - → 点击后显示"阻塞原因"（如"等待 TASK-02 完成"）

---

##### 【止损信号】

- ❌ **止损信号 1**：用户仍然需要打开终端查看 dev 状态
  - 验收标准：所有信息都能在控制台内查看（不需要开终端）
  - 降级方案：保留"快速打开终端"按钮（作为备选）

- ❌ **止损信号 2**：知识图谱树太复杂，用户看不懂
  - 验收标准：用户能在 30 秒内理解图谱布局
  - 降级方案：提供"简化视图"（只显示当前关注的路径）

#### 场景 2：分派新任务 - 从"手忙脚乱"到"一键搞定"

> 体验关键词：从"切终端、找对话、发指令"到"选任务、选人、点一下"

---

##### 【用户旅程】

**14:30** - 发现新任务 - 😕 "这个得找人做"
- **情境**：STORY-101 下面的 TASK-03（后端 API）已经可以开始了
- **痛点**：**P1-认知过载** - 之前需要在终端里找对应的 dev（引用 biz-overview P1）
- **内心独白**："TASK-03 可以开始了，Dave-1 在忙吗？我切过去看看..."
- **当前成本**：约 30-60 秒（切终端、找对话、确认状态、发指令）

**14:30:20** - 在控制台操作 - 😊 "挺直观"
- **动作**：在知识图谱树中点击 TASK-03（黄色高亮）
- **反馈**：
  - 系统高亮显示依赖路径：EPIC-001 → PRD-v1 → STORY-101 → TASK-03
  - 员工档案中显示"空闲的后端 dev"：Dave-1（绿色）、Dave-2（绿色）
- **感受**："哦，一眼就看到谁能干这个活"
- **预期 vs 实际**：预期要记哪个 dev 是后端，实际屏幕上直接显示

**14:30:40** - 分派任务 - 😄 "这就完了？"
- **动作**：点击 Dave-1 的"分派任务"按钮
- **反馈**：
  - 讨论室自动切换到 Dave-1 的 tab
  - 输入框自动填充："领 TASK-03，开始实现用户登录 API"
  - 点击"发送"即可
- **感受**："太方便了，不用打字，不用切窗口"
- **预期 vs 实际**：预期要输入一大段话，实际系统自动填充

**14:31** - 任务开始执行 - 😌 "心里踏实"
- **结果**：Dave-1 开始执行，运行终端实时显示日志
- **情绪变化**：从"手忙脚乱" → "掌控全局"
- **价值感知**："这个流程太顺畅了，比之前快多了"

---

##### 【体验北极星验证】

- ✅ 从"发现任务"到"开始执行"，只用了 30 秒（之前需要 1-2 分钟）
- ✅ 不需要在终端间切换，所有操作在控制台完成
- ✅ 认知负荷：从"记哪个 dev 是后端" → "看到绿色空闲标签"
- ✅ 减少操作步骤：从 6-8 步 → 3 步（选任务、选人、确认）

| 指标 | Before（当前） | After（目标） | 验收方式 |
|------|---------------|--------------|---------|
| 分派任务时间 | 30-60 秒 | < 30 秒 | 计时测试 |
| 操作步骤 | 6-8 步 | 3 步 | 计数 |
| 终端切换次数 | 2-3 次 | 0 次 | 计数 |
| 记忆负担 | 需要记 dev 角色 | 屏幕可见 | 用户报告 |

---

##### 【主路径】

1. **在知识图谱树中选中 TASK-03** → 系统高亮显示依赖路径
2. **在员工档案中选中空闲的 Dave-1** → 显示"分派任务"按钮
3. **点击"分派任务"按钮** → 讨论室自动切换到 Dave-1 的 tab
4. **系统自动填充任务描述** → 点击"发送"即可
5. **Dave-1 开始执行** → 运行终端显示实时日志，员工档案更新为"忙碌"

**成功标准**：
- ✅ 整个流程 < 30 秒
- ✅ 用户不需要切换到终端
- ✅ Agent 状态实时更新（延迟 < 1 秒）

---

##### 【分叉点】

- **[分叉 1]** 如果选中的 Agent 忙碌
  - → 提示："Dave-1 正在执行 TASK-01，是否等待？"
  - → 选项 A："等待"（加入队列，显示预计等待时间）
  - → 选项 B："选其他人"（高亮显示其他空闲的后端 dev）
  - → 选项 C："强制中断"（提示：中断后需要手动恢复）

- **[分叉 2]** 如果选中的 Agent 已释放
  - → 提示："Dave-1 已释放，是否自动启动？"
  - → 选项 A："自动启动并分派"（推荐）
  - → 选项 B："先启动，稍后分派"

- **[分叉 3]** 如果任务已分派给其他 Agent
  - → 警告："TASK-03 已分派给 Dave-2，是否重新分派？"
  - → 显示当前执行状态（进度、日志链接）
  - → 选项 A："重新分派"（中断 Dave-2）
  - → 选项 B："取消"（回到之前的任务）

---

##### 【止损信号】

- ❌ **止损信号 1**：用户仍然需要手动输入任务描述
  - 验收标准：系统能从 TASK 文档自动提取任务描述
  - 降级方案：提供"从 TASK 文档加载"按钮

- ❌ **止损信号 2**：分派任务超过 1 分钟
  - 验收标准：整个流程 < 30 秒
  - 降级方案：分析哪个步骤耗时，优化交互或提供快捷键

#### 场景 3：查看执行进度 - 从"盲目等待"到"实时掌控"

> 体验关键词：从"不知道dev在干啥、什么时候完成"到"一眼看到进度和错误"

---

##### 【用户旅程】

**15:00** - 开始等待 - 😕 "得盯着点"
- **情境**：刚给 Dave-1 分派了 TASK-03，需要等待完成
- **痛点**：**P1-认知过载** - 之前得盯着终端窗口，错过日志就麻烦了（引用 biz-overview P1）
- **内心独白**："Dave-1 在干什么呢？有没有报错？我切过去看看..."
- **当前成本**：需要频繁切终端，担心错过重要日志

**15:00:30** - 扫一眼运行终端 - 😊 "一眼看懂"
- **动作**：扫一眼运行终端中的 Dave-1 面板
- **反馈**：
  - 实时日志流：`[INFO] > cargo test --lib`
  - 进度条：`[=========>     ] 60%`
  - 状态："正在执行单元测试"
- **感受**："哦，在跑测试，进度还顺畅"
- **预期 vs 实际**：预期要滚屏看日志，实际有进度条一眼看懂

**15:02** - 发现错误 - 😟 "出错了"
- **动作**：看到红色高亮的错误日志
- **反馈**：
  - 错误日志自动高亮：`[ERROR] error: test failed at line 123`
  - 提供"询问 Agent"按钮
- **感受**："幸好一眼就看到了，不用翻日志"

**15:02:10** - 和 Agent 对话 - 😌 "有办法"
- **动作**：点击"询问 Agent"按钮，自动切换到讨论室的 Dave-1 tab
- **反馈**：
  - 输入框自动填充："测试失败了，怎么回事？"
  - Dave-1 分析日志，给出修复建议
- **感受**："这个功能太方便了，不用复制粘贴错误信息"
- **价值感知**："实时日志 + 一键询问，效率提升不少"

---

##### 【体验北极星验证】

- ✅ 从"盲目等待"到"实时掌控"，用户不需要频繁切终端
- ✅ 日志实时刷新，延迟 < 1 秒
- ✅ 错误信息自动高亮，用户不会遗漏
- ✅ 一键询问 Agent，不需要复制粘贴

| 指标 | Before（当前） | After（目标） | 验收方式 |
|------|---------------|--------------|---------|
| 日志查看频率 | 每分钟切2-3次终端 | 扫一眼屏幕即可 | 用户报告 |
| 错误发现时间 | 平均 2-5 分钟 | < 10 秒（自动高亮） | 故意注入错误测试 |
| 询问 Agent 时间 | 30-60 秒（复制+切窗口+粘贴） | < 10 秒（一键询问） | 计时测试 |

---

##### 【主路径】

1. **扫一眼运行终端** → 看到所有 Agent 的执行进度和实时日志
2. **发现错误日志** → 错误信息自动红色高亮
3. **点击"询问 Agent"按钮** → 自动切换到讨论室的对应 tab
4. **Agent 分析错误** → 给出修复建议或直接修复

**成功标准**：
- ✅ 日志实时刷新，延迟 < 1 秒
- ✅ 错误信息自动高亮
- ✅ 用户可以随时切换到讨论室和 Agent 对话

---

##### 【分叉点】

- **[分叉 1]** 如果日志太多，用户找不到关键信息
  - → 提供"只看错误"过滤按钮
  - → 提供"搜索日志"功能
  - → 提供"高亮关键词"功能

- **[分叉 2]** 如果 Agent 无响应
  - → 提示："Dave-1 无响应，是否重启？"
  - → 选项 A："重启并恢复"
  - → 选项 B："查看完整日志"（跳转到日志文件）

- **[分叉 3]** 如果日志刷太快，看不过来
  - → 提供"暂停日志流"按钮
  - → 提供"慢速模式"（限制刷新频率）

---

##### 【止损信号】

- ❌ **止损信号 1**：日志刷新延迟超过 2 秒
  - 验收标准：日志实时刷新延迟 < 1 秒
  - 降级方案：提供"手动刷新"按钮

- ❌ **止损信号 2**：用户仍然需要切终端看日志
  - 验收标准：所有日志都能在控制台看到
  - 降级方案：保留"快速打开日志文件"按钮

#### 场景 4：闲置自动释放 - 从"手动管理"到"自动回收"

> 体验关键词：从"得记得手动kill进程"到"系统自动释放资源"

---

##### 【用户旅程】

**16:00** - Dave-2 完成任务 - 😊 "干完了"
- **情境**：Dave-2 完成了 TASK-02，状态变为"空闲"
- **痛点**：**P3-进程管理复杂** - 之前得手动kill进程释放内存（引用 biz-overview P3）
- **内心独白**："Dave-2 干完了，我一会再给他派活，先挂着吧"
- **当前成本**：闲置进程占用内存，得手动管理

**16:05** - 系统自动释放 - 😌 "自动的？"
- **动作**：（用户在忙别的，没注意到）
- **反馈**：
  - 系统检测到 Dave-2 闲置超过 5 分钟
  - 自动释放 Dave-2 的进程
  - 员工档案中 Dave-2 状态变为"已释放"（灰色）
- **用户感受**：后来发现时"哦，系统自动释放了，不用我管"

**17:00** - 重新使用 Dave-2 - 😊 "恢复挺快"
- **动作**：给 Dave-2 分派新任务
- **反馈**：
  - 系统检测到 Dave-2 已释放
  - 自动启动进程并恢复 Session
  - 对话历史完整恢复
- **感受**："太方便了，不用手动启动，不用找历史记录"
- **价值感知**："自动管理进程，省心多了"

---

##### 【体验北极星验证】

- ✅ 用户不需要手动管理进程（启动/kill）
- ✅ 闲置资源自动释放，不浪费内存
- ✅ Session 自动恢复，对话历史不丢失

| 指标 | Before（当前） | After（目标） | 验收方式 |
|------|---------------|--------------|---------|
| 闲置释放方式 | 手动kill进程 | 自动释放 | 用户报告 |
| Session 恢复方式 | 手动指定 JSONL | 自动恢复 | 计时测试 |
| 内存浪费 | 闲置进程占用内存 | 自动释放 | 系统监控 |

---

##### 【主路径】

1. **Agent 完成任务** → 状态变为"空闲"，开始计时
2. **闲置超过 5 分钟** → 系统自动释放进程
3. **员工档案更新** → 状态变为"已释放"（灰色）
4. **用户重新分派任务** → 系统自动启动并恢复 Session

**成功标准**：
- ✅ 闲置检测准确，误杀率 < 1%
- ✅ Session 恢复成功率 > 95%
- ✅ 自动释放不影响其他 Agent

---

##### 【分叉点】

- **[分叉 1]** 如果 Agent 闲置期间用户正在查看对话
  - → 暂不释放，延长计时
  - → 提示："Dave-2 闲置中，是否继续释放？"

- **[分叉 2]** 如果 Session 恢复失败
  - → 提示："Session 损坏，是否启动新 Session？"
  - → 选项 A："启动新 Session"（失去历史对话）
  - → 选项 B："尝试修复 Session"

---

##### 【止损信号】

- ❌ **止损信号 1**：误杀率超过 5%（频繁误杀正在使用的 Agent）
  - 验收标准：误杀率 < 1%
  - 降级方案：延长闲置时间到 10 分钟，或提供"关闭自动释放"选项

- ❌ **止损信号 2**：Session 恢复成功率低于 80%
  - 验收标准：Session 恢复成功率 > 95%
  - 降级方案：移除自动释放功能，改为手动管理

#### 场景 5：理解任务依赖 - 从"不知道为啥做"到"一眼看懂上下文"

> 体验关键词：从"翻文档找上下文"到"点击节点看业务背景"

---

##### 【用户旅程】

**11:00** - 遇到问题 - 🤔 "这个Task是为了啥？"
- **情境**：正在执行 TASK-03（用户登录 API），遇到一个边界情况需要确认
- **痛点**：**P2-知识断层** - 之前得手动翻文档找业务背景（引用 biz-overview P2）
- **内心独白**："这个登录接口要支持第三方登录吗？我得看看 PRD 是怎么写的..."
- **当前成本**：约 5-10 分钟（找文档、翻到对应章节、理解上下文）

**11:00:20** - 在知识图谱中点击 - 😊 "路径高亮了"
- **动作**：在知识图谱树中点击 TASK-03
- **反馈**：
  - 系统高亮显示完整的依赖路径（黄色虚线）
  - 路径：EPIC-001 → PRD-v1 → STORY-101 → TASK-03
  - 每个节点显示状态：PRD-v1（✅ DONE）、STORY-101（🟡 DOING）
- **感受**："哦，原来这个 TASK 是从 STORY-101 来的"

**11:00:40** - 点击 PRD 节点 - 😌 "找到了"
- **动作**：点击路径上的 PRD-v1 节点
- **反馈**：
  - 侧边栏自动打开 PRD-v1 文档
  - 自动滚动到"用户登录"相关章节
  - 高亮显示"支持第三方登录"的需求描述
- **感受**："太方便了，不用手动翻文档了"

**11:01** - 理解业务背景 - 😄 "明白了"
- **结果**：快速理解 TASK-03 的业务背景和需求
- **情绪变化**：从"困惑" → "清晰"
- **价值感知**："知识图谱太有用了，一眼就能看到上下游"

---

##### 【体验北极星验证】

- ✅ 从"困惑"到"清晰"，只用了 1 分钟（之前需要 5-10 分钟）
- ✅ 不需要手动翻文档，点击节点即可
- ✅ 依赖路径可视化，用户一眼看到上下文

| 指标 | Before（当前） | After（目标） | 验收方式 |
|------|---------------|--------------|---------|
| 理解业务背景时间 | 5-10 分钟 | < 2 分钟 | 计时测试 |
| 找文档时间 | 2-3 分钟 | < 10 秒（点击节点） | 计时测试 |
| 依赖关系可见性 | 隐式（需手动查） | 显式（一键高亮） | 用户报告 |

---

##### 【主路径】

1. **在知识图谱树中点击 TASK-03** → 系统高亮显示依赖路径
2. **点击路径上的 PRD-v1 节点** → 侧边栏打开文档，自动滚动到相关章节
3. **查看需求描述** → 理解 TASK-03 的业务背景
4. **回到任务执行** → 继续实现，方向明确

**成功标准**：
- ✅ 依赖路径高亮显示，视觉清晰
- ✅ 点击节点后，文档打开时间 < 1 秒
- ✅ 用户能在 10 秒内理解业务背景

---

##### 【分叉点】

- **[分叉 1]** 如果文档太长，找不到相关章节
  - → 提供"跳转到相关章节"按钮（基于 TASK 关键词）
  - → 提供"在文档内搜索"功能

- **[分叉 2]** 如果依赖路径太长，看不清
  - → 提供"折叠中间节点"功能（只显示关键路径）
  - → 提供"聚焦模式"（只显示当前关注的分支）

- **[分叉 3]** 如果文档不存在（被删除了）
  - → 提示："文档已删除，是否从 git 历史恢复？"
  - → 选项 A："从 git 历史恢复"
  - → 选项 B："标记为缺失"

---

##### 【止损信号】

- ❌ **止损信号 1**：用户仍然需要手动翻文档
  - 验收标准：点击节点后，自动打开文档并跳转到相关章节
  - 降级方案：先实现"打开文档"，后续优化"自动跳转"

- ❌ **止损信号 2**：依赖路径高亮不清晰，用户看不懂
  - 验收标准：用户能在 10 秒内理解依赖路径
  - 降级方案：提供"文本模式"（用列表显示依赖关系）

---

## 5. 功能需求（Functional Requirements）

### 5.1 功能 F1：知识图谱树

**描述**：显示 Epic → PRD/TECH → STORY → TASK 的依赖关系，实时更新

**业务规则**：
- 节点类型：EPIC（黄色）、PRD（蓝色）、TECH（紫色）、STORY（绿色）、TASK（灰色）
- 节点状态：TODO（白色边框）、DOING（蓝色边框）、BLOCKED（红色边框）、DONE（绿色边框）
- 当前路径高亮：用户选中的任务路径用黄色高亮显示
- 实时更新：监听文件系统变化，自动刷新图谱（防抖 2 秒）

**权限**：
- 所有用户都可以查看知识图谱
- 只有主用户可以点击节点打开文档

**边界条件**：
- 空态：如果没有任何文档，显示"暂无项目数据"提示
- 加载态：显示骨架屏或加载动画
- 失败态：文档解析失败时，显示错误图标和错误信息
- 大规模数据：如果节点超过 100 个，提供折叠/过滤功能

**验收点**：
- AC1：用户能打开应用，看到完整的知识图谱树
- AC2：用户能点击节点，打开对应文档
- AC3：用户能选中一个 TASK，看到完整的依赖路径高亮
- AC4：用户修改文档后，知识图谱在 2 秒内自动刷新

### 5.2 功能 F2：讨论室

**描述**：多 tab 支持，和不同 Agent 进行多轮对话

**业务规则**：
- Tab 组件类似浏览器，支持创建、切换、关闭
- 每个 Agent 对应一个 tab（Tiger、Dave-1、Dave-2、Terry 等）
- 对话历史实时保存到 JSONL 文件
- Agent 可以创建文档、编码（通过 Claude Code 的工具）
- 输入框支持多行输入，快捷键发送（Cmd/Ctrl + Enter）

**权限**：
- 所有用户都可以和 Agent 对话
- 只有主用户可以创建/关闭 tab

**边界条件**：
- 空态：如果没有打开任何 tab，显示"点击 + 号创建新对话"提示
- 加载态：Agent 思考时，显示"对方正在输入..."动画
- 失败态：Agent 无响应时，显示"连接超时，请重试"提示
- 限制：最多同时打开 10 个 tab

**验收点**：
- AC1：用户能创建新的 tab，选择 Agent
- AC2：用户能在不同 tab 之间切换，保持对话上下文
- AC3：用户能发送消息，Agent 正确回复
- AC4：用户关闭 tab 后，对话历史正确保存到 JSONL
- AC5：用户重新打开 tab，能恢复之前的对话历史

### 5.3 功能 F3：运行终端

**描述**：显示各个 Agent 的执行进度和实时日志流

**业务规则**：
- 终端组件类似 VS Code 的集成终端
- 每个 Agent 对应一个终端面板
- 实时日志流（stream-json 解析）
- 日志级别：INFO（白色）、WARN（黄色）、ERROR（红色）
- 支持日志搜索和过滤
- 支持清空日志

**权限**：
- 所有用户都可以查看终端
- 只有主用户可以清空日志

**边界条件**：
- 空态：如果没有 Agent 在运行，显示"暂无活跃 Agent"提示
- 加载态：Agent 启动中，显示"正在启动..."动画
- 失败态：Agent 崩溃时，显示"Agent 进程异常退出"错误信息
- 性能：日志行数超过 1000 行时，自动清理旧日志

**验收点**：
- AC1：用户能打开应用，看到所有 Agent 的终端面板
- AC2：用户能实时看到 Agent 的日志输出（延迟 < 1 秒）
- AC3：用户能搜索日志，快速定位错误信息
- AC4：用户能清空日志，释放内存

### 5.4 功能 F4：进程管理

**描述**：启动/杀死 Claude Code 进程，Session 管理

**业务规则**：
- 启动 Agent：使用 `claude -p --input-format=stream-json --output-format=stream-json --agent <agent>` 命令
- 杀死 Agent：发送 SIGTERM 信号，优雅关闭
- Session 保存：每次对话后，追加到 JSONL 文件
- Session 恢复：Agent 启动时，从 JSONL 文件恢复上下文
- 闲置检测：超过 5 分钟无活动，自动释放 Agent

**权限**：
- 只有主用户可以启动/杀死 Agent

**边界条件**：
- 启动失败：Claude Code 进程启动失败时，显示错误信息，提供重试按钮
- 杀死失败：进程无法杀死时，显示"强制杀死"按钮
- Session 损坏：JSONL 文件损坏时，显示"Session 损坏"错误，提供修复工具
- 资源不足：系统内存不足时，显示警告，提示用户释放 Agent

**验收点**：
- AC1：用户能点击"启动"按钮，成功启动 Agent
- AC2：用户能点击"杀死"按钮，成功停止 Agent
- AC3：Agent 闲置 5 分钟后，自动释放资源
- AC4：Agent 重启后，能恢复之前的对话历史

### 5.5 功能 F5：员工档案

**描述**：显示每个 Agent 的状态、当前任务、技能标签

**业务规则**：
- Agent 状态：空闲（绿色）、忙碌（蓝色）、错误（红色）、已释放（灰色）
- 当前任务：显示正在执行的 TASK ID 和任务名称
- 技能标签：架构、后端、前端、测试等
- 历史任务：显示最近完成的 5 个任务

**权限**：
- 所有用户都可以查看员工档案
- 只有主用户可以编辑 Agent 信息

**边界条件**：
- 空态：如果没有创建任何 Agent，显示"暂无员工"提示
- 加载态：Agent 信息加载中，显示骨架屏
- 失败态：Agent 信息获取失败时，显示"无法获取 Agent 状态"错误

**验收点**：
- AC1：用户能打开应用，看到所有 Agent 的档案
- AC2：用户能点击 Agent，查看详细信息
- AC3：Agent 状态实时更新（延迟 < 1 秒）
- AC4：用户能编辑 Agent 的技能标签

### 5.6 功能 F6：手动调度

**描述**：手动分派任务给 Agent，触发 Agent 启动/停止

**业务规则**：
- 用户在知识图谱树中选择一个 TASK
- 用户在员工档案中选择一个空闲的 Agent
- 用户点击"分派任务"按钮
- 系统自动切换到讨论室的对应 tab
- 用户输入任务描述
- Agent 开始执行

**权限**：
- 只有主用户可以分派任务

**边界条件**：
- Agent 忙碌：如果选中的 Agent 正在执行任务，显示"Agent 忙碌"错误
- Agent 已释放：如果选中的 Agent 已释放，自动启动 Agent
- 任务已分派：如果任务已经分派给其他 Agent，显示警告

**验收点**：
- AC1：用户能选择一个 TASK 和一个 Agent，成功分派任务
- AC2：用户能点击"停止"按钮，中断 Agent 的执行
- AC3：系统能检测 Agent 忙碌状态，防止重复分派

---

## 6. 交互与信息结构（UX/UI）

### 页面/入口

**主界面布局**（已在 biz-overview 中确定）：

```
┌─────────────────────────────────────────────────────────┐
│  🕸️  指挥官全景图 (知识图谱)                            │
│  [ EPIC-001: 移动端 App ]                               │
│    │                                                    │
│    ├── 📘 [ PRD-v1: 需求规格 ]                         │
│    │       └─ 📄 [ STORY-101: 用户登录 ]              │
│    │                                                    │
│    ├── 📙 [ TECH-v1: 技术方案 ]                        │
│    │       └─ 🏗️ [ API-Schema: Auth接口定义 ]         │
│    │                                                    │
│    └── 📗 [ STORY-101: 用户登录闭环 ]                  │
│            │                                            │
│            ├── ✅ [ TASK-01: 后端 API 实现 ] (Dave-1)  │
│            └── 🟡 [ TASK-02: iOS 页面 ] (Dave-2)       │
├───────────────────────────┬─────────────────────────────┤
│  💬 讨论室 (规划大脑)      │  💻 运行终端 (执行肌肉)     │
│  [ 页签: Tiger | Dave-1 ]  │  [ 🟢 活跃: 2 | ⚪ 空闲: 1 ]│
│                           │                             │
│  (当前对话: Tiger)         │  +------------------------+│
│                           │  | 🟢 Dave-1 (后端开发)   ││
│  我: PRD 和 Tech 都好了。  │  | 正在执行: TASK-01      ││
│  让我们拆分 STORY-101。    │  | > cargo test --lib     ││
│                           │  +------------------------+│
│  Tiger: 好的。             │                             │
│  STORY-101 将拆分为:       │  +------------------------+│
│  1. TASK-01: 后端 API      │  | 🟡 Dave-2 (iOS 开发)   ││
│  2. TASK-02: iOS 页面      │  | 正在执行: TASK-02      ││
│                           │  +------------------------+│
└───────────────────────────┴─────────────────────────────┘
```

**区域划分**：
1. **顶部（40%）**：知识图谱树，显示全局依赖关系
2. **左下（30%）**：讨论室，多 tab 对话
3. **右下（30%）**：运行终端，实时日志流

### 信息结构

#### 知识图谱树
- **节点信息**：
  - 文档类型（EPIC/PRD/TECH/STORY/TASK）
  - 文档名称
  - 状态（TODO/DOING/BLOCKED/DONE）
  - 关联的 Agent（如果有）
- **边信息**：
  - 依赖关系方向（从父节点到子节点）
  - 依赖类型（包含/引用）

#### 讨论室
- **Tab 信息**：
  - Agent 名称
  - Agent 状态（空闲/忙碌/错误）
  - 未读消息数（可选）
- **对话历史**：
  - 消息时间戳
  - 发送者（用户/Agent）
  - 消息内容（支持 Markdown）
  - 工具调用结果（代码/文档创建等）

#### 运行终端
- **Agent 面板**：
  - Agent 名称
  - 当前任务
  - 进程状态（运行中/空闲/错误）
- **日志流**：
  - 时间戳
  - 日志级别（INFO/WARN/ERROR）
  - 日志内容

#### 员工档案
- **Agent 信息**：
  - Agent 名称
  - Agent 状态
  - 当前任务
  - 技能标签
  - 历史任务记录

### ASCII 草图（可选）

#### 主窗口结构
```
┌─────────────────────────────────────────────────────────┐
│  Commander Console                    [− □ ×]           │
├─────────────────────────────────────────────────────────┤
│  [知识图谱] [讨论室] [终端] [员工档案]                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  （知识图谱树）                                          │
│                                                          │
├───────────────────────────┬─────────────────────────────┤
│  （讨论室）                │  （运行终端）               │
│                           │                             │
└───────────────────────────┴─────────────────────────────┘
```

#### 知识图谱节点
```
┌─────────────────────┐
│  📘 PRD-v1          │
│  状态: ✅ DONE      │
│  关联: [Tiger]      │
└─────────────────────┘
         │
         ▼
┌─────────────────────┐
│  📄 STORY-101       │
│  状态: 🟡 DOING     │
│  关联: [Dave-1]     │
└─────────────────────┘
```

#### 讨论室 Tab
```
┌─────────────────────────────────────────────────────────┐
│ [Tiger 🟢] [Dave-1 🔵] [Dave-2 ⚪] [Terry ⚪] [+]      │
├─────────────────────────────────────────────────────────┤
│  我: PRD 和 Tech 都好了。让我们拆分 STORY-101。          │
│                                                          │
│  Tiger: 好的。STORY-101 将拆分为:                         │
│  1. TASK-01: 后端 API 实现                                │
│  2. Auth接口实现                                         │
│                                                          │
│  [在此输入消息...]                     [发送]            │
└─────────────────────────────────────────────────────────┘
```

#### 运行终端面板
```
┌─────────────────────────────────────────────────────────┐
│  🟢 Dave-1 (后端开发)                                    │
│  正在执行: TASK-01                                       │
├─────────────────────────────────────────────────────────┤
│  2026-01-14 10:23:45 [INFO]  > cargo test --lib        │
│  2026-01-14 10:23:46 [INFO]     Compiling...           │
│  2026-01-14 10:23:50 [WARN]     warning: unused...     │
│  2026-01-14 10:23:52 [ERROR]    error: test failed...  │
│                                                          │
│  [搜索日志...] [清空]                                    │
└─────────────────────────────────────────────────────────┘
```

---

## 6.1 UI 证据（Evidence）（强烈推荐）

> 目的：让"页面长什么样"尽早可感知，避免仅凭想象写长文档导致返工。
>
> 建议：
> * PRD v0：至少提供一个可运行最小原型或 1 张关键截图/录屏
> * PRD v1：主路径 + 关键状态必须有证据（空/加载/失败/成功）

### 原型（推荐）

**可运行 HTML 原型**：`/docs/E-001-Agent-Console/prototypes/index.html`

> 注：原型由 UX agent 并行生成，本 PRD 引用原型链接。

**原型包含的关键页面**：
1. 主界面布局（知识图谱 + 讨论室 + 运行终端）
2. 知识图谱树（节点、边、状态）
3. 讨论室（多 tab、对话历史）
4. 运行终端（日志流、进程状态）
5. 员工档案（Agent 信息）

### 截图/录屏（可选）

（待 UX agent 提供原型后补充）

### 关键状态说明

#### 空态
- **知识图谱**：显示"暂无项目数据"提示，引导用户创建第一个 Epic
- **讨论室**：显示"点击 + 号创建新对话"提示
- **运行终端**：显示"暂无活跃 Agent"提示
- **员工档案**：显示"暂无员工"提示

#### 加载态
- **知识图谱**：显示骨架屏或加载动画
- **讨论室**：Agent 思考时，显示"对方正在输入..."动画
- **运行终端**：Agent 启动中，显示"正在启动..."动画
- **员工档案**：显示骨架屏

#### 失败态
- **知识图谱**：文档解析失败时，显示错误图标和错误信息，提供"重试"按钮
- **讨论室**：Agent 无响应时，显示"连接超时，请重试"提示
- **运行终端**：Agent 崩溃时，显示"Agent 进程异常退出"错误信息，提供"重新启动"按钮
- **员工档案**：Agent 信息获取失败时，显示"无法获取 Agent 状态"错误

#### 成功态
- **知识图谱**：显示完整的依赖关系树，节点状态用颜色标识
- **讨论室**：显示对话历史，Agent 正常响应
- **运行终端**：显示实时日志流，日志级别用颜色标识
- **员工档案**：显示所有 Agent 的信息，状态实时更新

---

## 7. 业务约束与风险（Constraints & Risks）

> 说明：本章节记录业务层面的约束条件和风险，不涉及技术实现细节。

### 7.1 用户体验要求

**响应速度**：
- 应用启动时间 < 3 秒
- 全局状态刷新时间 < 1 秒
- 日志实时刷新延迟 < 1 秒
- 文档打开时间 < 1 秒

**数据量**：
- 默认展示最近 1000 条日志
- 默认展示最近 5 个历史任务
- 知识图谱默认展开 3 层

### 7.2 错误处理

**用户体验层面的错误提示**：
- 显示友好错误信息（如"连接超时，请重试"）
- 提供重试按钮
- 显示错误原因（如"Agent 进程异常退出"）
- 提供恢复路径（如"重新启动"、"查看日志"）

**不涉及技术实现**：
- 不写 HTTP 状态码
- 不写异常处理逻辑

### 7.3 权限和隐私

**谁可以访问**：
- Phase 1：只有主用户（开发者自己）
- Phase 2+：其他独立开发者/小团队（待定）

**需要保护哪些信息**：
- 对话历史（可能包含敏感信息）
- Agent 配置（可能包含 API Key）
- 不显示敏感个人信息（目前不涉及）

### 7.4 业务约束

**分阶段上线**：
- Phase 1：只伺候好用户自己（单用户）
- Phase 2+：考虑多用户支持（待定）

**功能开关**：
- 不需要功能开关（Phase 1 是全功能发布）
- 未来可能需要"自动调度"开关（Phase 2）

**其他业务层面的约束**：
- 需要系统级能力（启动/杀死进程）→ 必须用 Tauri
- 未来要给非技术用户用（单一可执行文件）
- 需要支持跨平台（至少 macOS + Linux）

### 7.5 业务风险

**可能的风险**：
1. **可视化可能反而增加认知负荷**
   - 缓解：简洁的 UI 设计，提供折叠/过滤功能
   - 验证：用户测试和反馈迭代

2. **进程管理频繁出错**
   - 缓解：优雅的降级方案（手动启动）
   - 验证：持续验证稳定性

3. **Session 恢复失败**
   - 缓解：提供手动修复工具
   - 验证：测试各种边界情况

**风险缓解措施**：
- 提供"手动启动"降级方案
- 提供使用指南和检查点
- 用户测试和反馈迭代

---

## 8. 验收标准（Acceptance Criteria）

> 说明：本章节记录可测试的验收标准，每个 AC 应该包含"步骤 + 期望结果"。

### AC1：用户能打开应用，看到完整的知识图谱树
**步骤**：
1. 用户双击 Commander Console 应用图标
2. 等待应用启动
3. 查看主界面

**期望结果**：
- ✅ 应用在 3 秒内启动完成
- ✅ 显示完整的知识图谱树（EPIC → PRD/TECH → STORY → TASK）
- ✅ 节点状态用颜色正确标识（TODO/DOING/BLOCKED/DONE）
- ✅ 没有明显的卡顿或闪烁

### AC2：用户能点击知识图谱节点，打开对应文档
**步骤**：
1. 用户在知识图谱树中找到一个 TASK 节点
2. 用户点击该节点
3. 等待文档打开

**期望结果**：
- ✅ 文档在 1 秒内打开
- ✅ 文档内容正确显示
- ✅ 侧边栏或弹窗显示文档内容

### AC3：用户能创建新的讨论室 tab，和 Agent 对话
**步骤**：
1. 用户在讨论室中点击"+"按钮
2. 用户选择一个 Agent（如 Dave-1）
3. 用户在输入框中输入消息："你好"
4. 用户点击"发送"按钮
5. 等待 Agent 回复

**期望结果**：
- ✅ 新 tab 创建成功
- ✅ 消息显示在对话历史中
- ✅ Agent 在 5 秒内回复
- ✅ Agent 回复内容正确

### AC4：用户能实时看到 Agent 的日志输出
**步骤**：
1. 用户在运行终端中找到 Dave-1 的面板
2. 用户在讨论室中让 Dave-1 执行任务
3. 用户观察日志流

**期望结果**：
- ✅ 日志实时刷新（延迟 < 1 秒）
- ✅ 日志内容正确显示
- ✅ 错误日志用红色高亮
- ✅ 警告日志用黄色高亮

### AC5：用户能启动和停止 Agent
**步骤**：
1. 用户在员工档案中找到一个已释放的 Agent（如 Dave-2）
2. 用户点击"启动"按钮
3. 等待 Agent 启动
4. 用户点击"停止"按钮
5. 等待 Agent 停止

**期望结果**：
- ✅ Agent 在 3 秒内启动完成
- ✅ Agent 状态变为"空闲"
- ✅ Agent 在 2 秒内停止完成
- ✅ Agent 状态变为"已释放"

### AC6：Agent 闲置 5 分钟后自动释放
**步骤**：
1. 用户启动一个 Agent（如 Dave-1）
2. 用户不给 Agent 分派任何任务
3. 用户等待 5 分钟
4. 用户观察员工档案

**期望结果**：
- ✅ Agent 在 5 分钟后自动释放
- ✅ Agent 状态变为"已释放"
- ✅ 对话历史正确保存到 JSONL

### AC7：用户能分派任务给 Agent
**步骤**：
1. 用户在知识图谱树中选择一个 TODO 状态的 TASK
2. 用户在员工档案中选择一个空闲的 Agent
3. 用户点击"分派任务"按钮
4. 系统自动切换到讨论室的对应 tab
5. 用户输入任务描述
6. 等待 Agent 开始执行

**期望结果**：
- ✅ 任务成功分派给 Agent
- ✅ Agent 状态变为"忙碌"
- ✅ 讨论室自动切换到对应 tab
- ✅ Agent 开始执行任务
- ✅ 运行终端显示实时日志

### AC8：用户能理解任务依赖关系
**步骤**：
1. 用户在知识图谱树中点击一个 TASK 节点
2. 用户观察高亮显示的依赖路径
3. 用户点击路径上的 PRD 节点
4. 等待文档打开

**期望结果**：
- ✅ 依赖路径用黄色高亮显示
- ✅ 路径清晰可读（EPIC → PRD → STORY → TASK）
- ✅ PRD 文档在 1 秒内打开
- ✅ 用户能在 10 秒内理解业务背景

---

## 9. 待确认问题（[OPEN]）（可选）

> 说明：记录 PRD 编写过程中发现的待确认问题，供后续讨论。

### [OPEN-1] 前端框架选择
- **问题**：React / Vue / Svelte？
- **考虑因素**：学习曲线、生态、性能、开发体验
- **建议**：先做技术调研，快速验证
- **责任方**：tech

### [OPEN-2] 知识图谱可视化库选择
- **问题**：D3.js / Cytoscape.js / vis.js？
- **考虑因素**：功能、性能、学习曲线
- **建议**：先做原型，对比效果
- **责任方**：tech

### [OPEN-3] 终端模拟器选择
- **问题**：xterm.js / 其他？
- **考虑因素**：功能、性能、兼容性
- **建议**：先验证 xterm.js 是否满足需求
- **责任方**：tech

### [OPEN-4] Session 格式设计
- **问题**：JSONL 结构如何定义？
- **考虑因素**：需要支持对话历史、任务状态、错误恢复
- **建议**：参考现有格式（如 ChatGPT 的导出格式）
- **责任方**：tech

### [OPEN-5] Agent 模板设计
- **问题**：默认提供哪些 Agent？
- **考虑因素**：Tiger（架构师）、Dave-1/2（开发）、Terry（Reviewer）...
- **建议**：先基于现有的 Agent 定义
- **责任方**：prd + biz-owner

### [OPEN-6] 跨平台支持
- **问题**：是否需要支持 Windows？
- **考虑因素**：用户群体、开发成本
- **建议**：先支持 macOS + Linux，Windows 后续
- **责任方**：proj + biz-owner

### [OPEN-7] 多窗口支持
- **问题**：是否需要支持多窗口？
- **考虑因素**：用户场景、开发复杂度
- **建议**：先单窗口，多窗口后续
- **责任方**：prd + proj

### [OPEN-8] 知识图谱节点数量限制
- **问题**：如果节点超过 100 个，如何处理？
- **考虑因素**：性能、可读性
- **建议**：提供折叠/过滤功能，默认展开 3 层
- **责任方**：prd + ux

---

## 10. Gate B（进入厚 STORY/TECH 前必须满足）

> 触发时机：写完 PRD v0 后，准备开始写厚 STORY 或 TECH 文档前

### 检查清单

#### UI 证据验收

- [ ] **ASCII 线框图完整**：至少包含主界面布局（知识图谱 + 讨论室 + 终端）
- [ ] **用户看完能说"方向对了"**：布局符合预期，没有明显的交互问题
- [ ] **HTML 原型可运行**（可选但推荐）：`/docs/E-001-Agent-Console/prototypes/index.html`
- [ ] **关键状态已定义**：空态、加载态、失败态、成功态都有说明

#### 用户旅程验收

- [ ] **至少有 5 个完整场景**：场景1-5 都已定义
- [ ] **每个场景包含用户旅程**：情感曲线 + 体验北极星 + Before/After 对比
- [ ] **每个场景包含分叉点**：边界情况的处理方式
- [ ] **每个场景包含止损信号**：什么情况说明功能失败了

#### 需求清晰度验收

- [ ] **功能需求完整**：F1-F6 六个功能都有明确描述
- [ ] **验收标准可测试**：每个 AC 都有"步骤 + 期望结果"
- [ ] **[OPEN] 问题有责任方**：所有待确认问题都有明确的责任方
- [ ] **核心场景可复现**：场景1-5 的主路径都能被手工复现

### 验收标准

**通过条件**：
- 用户能回答以下问题：
  1. "页面长什么样？" → 能描述 ASCII 线框图的布局
  2. "用户怎么用？" → 能复述 5 个核心场景的主路径
  3. "什么情况算方向对了？" → 看 UI 证据后能说"差不多就是这样"

**不通过条件**：
- UI 证据缺失（没有 ASCII 线框图）
- 场景描述不完整（缺少用户旅程或分叉点）
- 验收标准不可测试（只有描述，没有步骤）

### 重新触发 Gate B 的条件

如果发生以下变更，需要重新通过 Gate B：
- 页面布局发生重大变化
- 新增或删除核心功能
- 用户场景发生重大调整

---

## 11. 变更记录（Changelog）

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v0.0 | 2026-01-14 | yinwm | 初版 PRD v0，基于 biz-overview 生成 |

---

## 附录：关键术语

| 术语 | 定义 |
|------|------|
| **Agent** | AI 员工，如 Tiger（架构师）、Dave-1/2（开发）、Terry（Reviewer） |
| **知识图谱树** | 显示 Epic → PRD/TECH → STORY → TASK 依赖关系的可视化图谱 |
| **讨论室** | 多 tab 对话界面，和不同 Agent 进行多轮对话 |
| **运行终端** | 显示 Agent 执行进度和实时日志流的终端面板 |
| **员工档案** | 显示 Agent 状态、当前任务、技能标签的信息卡片 |
| **Session** | Agent 的对话历史和状态，保存在 JSONL 文件中 |
| **闲置释放** | Agent 闲置超过 5 分钟后，自动释放资源 |
| **L1 手动调度** | 用户手动分派任务给 Agent，不自动匹配 |
| **L2 自动匹配** | 自动匹配"TASK-01 需要后端" → 找 Dave-1（Phase 2） |
| **L3 自主协调** | Agent 之间自主协商任务分配（Phase 3） |

---

## 附录：参考项目

- **Gas Town**: Multi-agent orchestration for Claude Code (https://github.com/steveyegge/gastown)
- **Vibe-Kanban**: Kanban board for AI agents (https://github.com/BloopAI/vibe-kanban)
