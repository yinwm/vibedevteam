# 业务概览 - E-001: Commander Console

> 文档路径：`/docs/E-001-Agent-Console/biz/BIZ-E-001-v0.md`
>
> * EPIC_ID：E-001
> * EPIC_NAME：Commander Console（AI 员工管理控制台）
> * 文档状态：草稿
> * 版本：v0
> * 创建人：yinwm
> * 创建日期：2026-01-14
> * 更新日期：2026-01-20

---

## 0. 关联信息（References）

* 项目级 biz-overview：`/docs/_project/biz-overview.md`
* PRD：`../prd/PRD-E-001-v0.md`
* Tech：`../tech/TECH-E-001-v1.md`（待生成）
* Proj：`../proj/PROJ-E-001-v1.md`（待生成）

---

## 1. 背景与现状（Background）

### 现状

用户正在开发 **VibedevTeam** 工作流框架，用于多 AI Dev 并行开发。当前工作流分为两个阶段：

1. **规划阶段**：确定 Epic → 写文档(PRD/TECH/STORY/TASK) → 用 beads 编排任务
2. **开发阶段**：用 proj 人格进行进度跟踪 → 识别可并行任务 → 启动多个 dev 并行开发 → tech review → proj 汇总进度并继续分派任务

目前已实现：
- ✅ Beads 任务管理系统（Git-backed issue tracker）
- ✅ 多 Agent 协作框架（biz-owner/prd/tech/proj/dev 等）
- ✅ 标准化文档模板和工作流
- ✅ TDD 驱动的开发流程

### 痛点

在实际使用多 AI Dev 并行开发时，遇到以下核心问题：

#### 1. 认知过载（P1）
- 需要在多个终端间切换上下文
- 4 个并行 dev 已经"跟不住了"
- 每个终端都是独立的对话上下文，无法统一管理

#### 2. 进度可视化缺失（P2）
- 需要人工盯着终端看进度
- 任务状态散落在各处
- 经常忘了"这个 Task 是为了哪个 PRD 服务的"
- 依赖关系不清晰，不知道哪些任务可以并行

#### 3. 调度效率低（P3）
- 手动识别可并行任务
- 手动在终端间切换，给不同的 dev 分派任务
- 无法实时看到所有 Agent 的工作状态

#### 4. 知识断层（P4）
- Epic → PRD/TECH → STORY → TASK 的依赖关系不可见
- 讨论、拆解、开发的知识是分散的
- 缺乏全局视角

### 为什么现在要做

1. **紧迫性**：用户已经在实践中遇到瓶颈，4 个并行 dev 已经是极限，但理论上应该能管理更多
2. **技术可行性**：Claude Code 提供 stream-json I/O 模式，可以外部管理对话
3. **战略价值**：这是 VibedevTeam 的核心基础设施，直接影响开发效率
4. **参考项目已有先例**：Gas Town（Multi-agent orchestration for Claude Code）、Vibe-Kanban（Kanban board for AI agents）

---

## 2. 业务问题（Problems）

### P1: 多 Agent 并行调度的认知负荷过高

**现状描述**：
- 用户需要在多个终端窗口间切换，每个终端对应一个 Claude Code 实例
- 需要记住哪个 dev 在做什么任务，当前进度如何
- 手动判断任务依赖关系，决定分派顺序
- 4 个并行 dev 已经达到认知极限

**根因分析**：
- 缺乏统一的状态可视化管理
- 缺乏任务依赖关系的自动识别
- 缺乏 Agent 生命周期的自动化管理

**影响**：
- 限制了并行度，无法充分利用 AI 的并行能力
- 容易出错，可能遗漏某个 dev 的进度
- 时间浪费在上下文切换上

---

### P2: 知识依赖关系不可追溯

**现状描述**：
- 文档（Epic/PRD/TECH/STORY/TASK）之间的关系是隐式的
- 讨论过程中的决策和背景知识散落在对话历史中
- 无法快速回答"这个 Task 是为了解决什么业务问题"

**根因分析**：
- 缺乏知识图谱的可视化
- 文档之间的依赖关系没有显式建模
- 讨论内容和任务执行结果没有关联

**影响**：
- 新人（或未来的自己）难以理解全局
- 容易失去对"为什么做这件事"的感知
- 复盘和总结困难

---

### P3: Agent 生命周期管理复杂

**现状描述**：
- Claude Code 进程需要手动启动/杀死
- Session 恢复需要手动操作
- 资源管理（闲置 Agent 的释放）需要人工判断

**根因分析**：
- 缺乏进程管理的抽象层
- 缺乏 Session 状态的持久化和恢复机制
- 缺乏资源使用的监控和自动化

**影响**：
- 操作繁琐，容易出错
- 资源浪费（闲置 Agent 占用内存）
- 体验不够流畅

---

## 3. 业务目标与指标（Goals & Metrics）

| 目标ID | 目标（Goal） | 当前值 | 目标值 | 口径/备注 |
|------|------------|------|------|--------|
| G1 | 能同时管理的并行 Dev 数量 | 4 个 | 8+ 个 | 在不增加认知负荷的前提下 |
| G2 | 单次上下文切换时间 | [OPEN] | < 5 秒 | 从一个 Agent 的状态切换到另一个 Agent 的状态 |
| G3 | 任务依赖关系可见性 | 0% | 100% | 所有 TASK 都能追溯到对应的 PRD/TECH |
| G4 | Agent 闲置资源释放时间 | 人工 | 5 分钟 | 自动检测并释放闲置超过 5 分钟的 Agent |
| G5 | 全局状态刷新时间 | [OPEN] | < 1 秒 | 知识图谱树、Agent 状态等全局视图的刷新延迟 |

### 反证信号（什么情况说明假设错了）

- 如果做了控制台后，用户仍然需要在终端间切换 → 说明调度能力不足
- 如果知识图谱树太复杂，反而增加了认知负荷 → 说明可视化方式有问题
- 如果进程管理频繁出错（Claude Code 进程杀不死/启动不了）→ 说明底层通信不稳定

---

## 4. 范围与非目标（Scope & Non-goals）

### 核心价值

让用户能舒适地管理 8+ 个并行 Dev，而不增加认知负荷。

### In Scope（MVP - Phase 1）

#### 1. 知识图谱树（F1）
- 解析文档 Frontmatter，显示 Epic → PRD/TECH → STORY → TASK 的依赖关系
- 实时更新（监听文件系统变化）
- 点击节点打开对应文档
- 显示任务状态（TODO/DOING/BLOCKED/DONE）
- 高亮显示当前关注的任务路径

#### 2. 讨论室（F2）
- 多 tab 支持，保持不同 Agent 的对话上下文
- 和具名 Agent（Tiger、Dave-1/2、Terry 等）进行多轮对话
- Agent 可以创建文档、编码（通过 Claude Code 的工具）
- 对话历史持久化（JSONL 格式）

#### 3. 运行终端（F3）
- 显示各个 Agent 的执行进度
- 实时日志流（stream-json 输出）
- 进程状态指示（运行中/空闲/错误）

#### 4. 进程管理（F4）
- 启动/杀死 Claude Code 进程
- Session 管理（从 JSONL 恢复上下文）
- 资源监控（内存、CPU、闲置时间）
- 自动释放闲置超过 5 分钟的 Agent

#### 5. 员工档案（F5）
- 显示每个"数字员工"的状态
- 当前任务、技能标签
- 历史任务记录（可选）

#### 6. 手动调度（F6）（L1 级别）
- 手动分派任务给 Agent
- 手动触发 Agent 启动/停止

### Out of Scope（Phase 2+）

#### 自动任务调度（L2 级别）
- 自动匹配"TASK-01 需要后端" → 找 Dave-1
- 自动检测任务依赖，识别可并行任务
- 依赖冲突检测和解决

#### 智能摘要
- 压缩对话历史，减少上下文长度
- 自动生成日报/周报

#### 自主协调（L3 级别）
- Agent 之间自主协商任务分配
- Agent 自主拆解任务

#### 非技术用户支持
- 傻瓜化操作界面
- 无需了解 Claude Code 即可使用

#### 多模态交互
- 语音输入/输出
- 可视化拖拽式任务编排

#### 团队协作
- 多用户共享控制台
- 权限管理
- 审计日志

---

## 5. Gate A（进入 PRD v0 前必须满足）

### 检查清单

- [ ] **目标清晰**：能复述本 Epic 的核心目标（管理 8+ 个并行 dev，不增加认知负荷）
- [ ] **痛点明确**：能列出 P1/P2/P3 三个核心痛点
- [ ] **范围清晰**：能区分 In Scope（F1-F6）和 Out of Scope（Phase 2+）
- [ ] **止损信号存在**：知道什么情况下要停下来
- [ ] **成功标准可量化**：G1-G5 五个目标有明确的当前值和目标值

### 验收标准

**通过条件**：
- 用户能回答以下问题：
  1. "为什么要做 Commander Console？" → 解决 P1/P2/P3
  2. "什么情况下算成功？" → G1-G5 达标
  3. "什么情况下要停下来？" → 触发止损信号

**不通过条件**：
- 用户无法复述 Epic 目标
- 痛点不清晰或未被验证
- 没有明确的止损信号

---

## 6. 止损信号（Stop Signals）

### 技术止损

- **触发条件**：如果无法稳定实现 Claude Code 的 stream-json 通信
- **验收标准**：连续 100 次通信测试，成功率 > 95%
- **降级方案**：退回到"一次性任务"模式

### 功能止损

- **触发条件**：如果进程管理太复杂，频繁出错
- **验收标准**：启动/杀死 Agent 成功率 > 95%
- **降级方案**：简化为"手动启动"，先聚焦可视化和调度

### 范围止损

- **触发条件**：如果 Tauri 开发成本太高，2 周内无法完成 MVP
- **验收标准**：2 周内完成核心功能原型
- **降级方案**：考虑降级到 Web 应用（失去系统级能力）

### 价值止损

- **触发条件**：如果可视化反而增加认知负荷
- **验收标准**：用户报告"管理 8 个 dev 不比管理 4 个 dev 累"
- **降级方案**：简化 UI，提供"最小视图"

---

## 7. 调度能力分级（Orchestration Levels）

| 级别 | 能力 | 描述 | 当前目标 |
|-----|------|------|---------|
| **L1** | 手动调度 | "Dave-1 领 TASK-01" | ✅ Phase 1 |
| **L2** | 自动匹配 | "TASK-01 需要后端" → 找 Dave-1 | Phase 2 |
| **L3** | 自主协调 | "做登录功能" → 拆任务、分派 | Phase 3 |
| **L4** | 自主决策 | "提升留存" → 分析、方案、执行 | 长期愿景 |

**当前聚焦**：L1 手动调度
- 用户手动分派任务给 Agent
- 控制台提供可视化支持
- 降低认知负荷，但不替代决策

---

## 8. 变更记录（Changelog）

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v0.0 | 2026-01-14 | yinwm | 从项目级 biz-overview 拆分，创建 Epic 级文档 |
| v0.1 | 2026-01-20 | yinwm | 补充 Gate A 检查清单和止损信号 |

---

## 附录：参考项目

- **Gas Town**: Multi-agent orchestration for Claude Code (https://github.com/steveyegge/gastown)
- **Vibe-Kanban**: Kanban board for AI agents (https://github.com/BloopAI/vibe-kanban)
