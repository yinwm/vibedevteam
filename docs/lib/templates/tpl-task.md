# {{TASK_ID}}: {{TASK_TITLE}}

> 文档路径：`/docs/{{EPIC_DIR}}/task/{{TASK_ID}}-{{TASK_TITLE}}.md`
> 任务ID：{{TASK_ID}}
> Beads 任务ID：`{{BEADS_ID}}`（必填）
> 任务标题：{{TASK_TITLE}}
> Epic：{{EPIC_ID}} {{EPIC_NAME}}
> Epic 目录：`{{EPIC_DIR}}`
> 状态（以 beads 为准）：TODO / DOING / BLOCKED / DONE
> 负责人：{{OWNER}}
> 预估工期：{{ESTIMATE}}
> 创建日期：{{YYYY-MM-DD}}
> 完成日期：{{YYYY-MM-DD}}
>
> 完成定义（硬护栏）：进入 `DONE` 前必须满足「验收标准（AC）+ 测试结果 + 回滚方案 + 上线观测点」并在本文回写证据（必要时链接到 `PROJ-*.md` 的 Release Gate）。

---

## 0. 状态与进展（由 beads 维护；本文档只回写证据）

### 0.1 Beads 状态（只读）

* Beads 任务：`{{BEADS_ID}}`
* 状态：TODO / DOING / BLOCKED / DONE
* 查看：`bd show {{BEADS_ID}}`

### 0.2 镜像记录（可选）

* 正在做什么（Now）：
* 下一步（Next）：
* 阻塞点（Blockers，如有）：

### 0.3 状态流转记录（可选，仅镜像）

| 日期 | 状态 | 说明 |
|------|------|------|
| {{YYYY-MM-DD}} | TODO | 创建任务 |

### 0.4 Review/验收记录（循环直到通过）

**tech 代码 Review（循环）**：
- [ ] ✅ Review 通过（APPROVE）
- [ ] 🔄 Review 不通过次数：__ 次
- [ ] 📝 Review 意见记录：
  | 轮次 | Verdict | 意见摘要 | 修改结果 |
  |------|---------|----------|----------|
  | 1 | NEEDS_CHANGES/BLOCK | ... | 已修改/待修改 |
  | 2 | APPROVE | - | - |
- [ ] ⚠️ **禁止提前 commit**：Review 通过前绝对不要执行 Git Commit

**prd 需求验收**：
- [ ] AC 对照验证通过
- [ ] 边界情况覆盖确认

**proj Release Gate**：
- [ ] 测试证据齐全
- [ ] 回滚方案明确
- [ ] 观测点可验证

## 1. 任务目标

* 做什么：
* 为什么做：
* 不做什么（可选）：

## 2. 关联关系

* 关联 Epic：{{EPIC_ID}}
* 关联 Story（必填；技术债/纯重构等可写 `NO_STORY`）：`../story/{{STORY_ID}}-*.md`
* 关联 Slice（必填；技术债/纯重构等可写 `NO_SLICE`）：`../slice/{{SLICE_ID}}.md`
* 关联 TECH：`../tech/TECH-{{EPIC_ID}}-v1.md`（如有）
* 关联 PROJ：`../proj/PROJ-{{EPIC_ID}}-v1.md`（如有）
* 上游依赖（Task/模块/接口）：
  - **硬依赖**（代码必须的依赖）：
    - TASK-XXX（原因：...）
  - **接口依赖**（需要其他任务的接口）：
    - TASK-YYY（原因：...）
  - **无依赖**（可以立即启动）：
    - 说明：...
  - **禁止使用 mock**（必须用真实接口）
* 下游任务（如有）：
* 与现有代码关系（要改哪些包/文件）：

## 3. 验收标准

### 3.1 功能验收标准

- [ ] AC1：
- [ ] AC2：

### 3.2 性能/质量验收标准（可选）

- [ ] 性能：
- [ ] 稳定性：

## 4. 实施方案

* 改动点列表（文件/模块）：
* 数据结构 / API（如有）：
  - 引用 TECH 文档的接口契约：`../tech/TECH-{{EPIC_ID}}-v1.md#4.3`
  - 必须按契约实现，不得偏离
  - 如契约与实际代码不符，必须在 TASK 文档中记录并同步更新 TECH 文档
* 关键流程：
* 复用与小范围重构（避免重复造轮子）：
  * 复用检查：仓库中已有实现/能力：`...`（如无写“未发现”）
  * 复用/扩展策略：`...`
  * 小范围重构点与兼容策略：`...`

## 5. 测试（计划与结果）

### 5.0 TDD（Test First）（P0/P1 推荐，能做尽量做）

* 先写哪些测试（文件/用例名）：
* 关键断言：
* 运行命令（本地/CI）：
* 预期：在实现前应失败、实现后应通过（如适用）：
* 真数据真流程验证（P0/P1 作为 Gate - 强制）：
  - ⛔ **禁止使用 mock 数据或假接口**
  - 必须使用真实数据/真实接口进行端到端验证
  - 环境/步骤/命令/结果：
  - 如发现使用 mock，此任务验收不通过

### 5.1 测试用例（计划）

* 单元测试：
* 集成测试：
* 回归点：

### 5.2 测试结果（回填）

- [ ] 单元测试结果（命令/报告/关键断言）：
- [ ] 集成测试结果（命令/环境/关键用例）：
- [ ] 手工验收记录（步骤/截图/结论，如适用）：
- [ ] 回归执行记录（至少 5 条关键回归点）：

## 6. 实现记录（回填）

* 实际改动：
* 关键 PR / commit（可选）：
* 线上开关/配置（如有）：

## 7. 风险与回滚

* 风险：
* 回滚：
* 上线后观测点（日志/指标/告警/仪表盘链接）：

## 8. 变更记录（Changelog）

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0 | {{YYYY-MM-DD}} | {{OWNER}} | 初版 |
